<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Farmer Login</title>
  <!-- Bootstrap CDN -->
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css" rel="stylesheet" />
  <style>
    body { background: linear-gradient(120deg,#e9f7ef,#f0f9ff); min-height:100vh; }
    .card { border-radius:16px; box-shadow:0 8px 24px rgba(15,23,42,0.08); }
    .logo { width:72px; height:72px; border-radius:12px; background:#fff; display:flex; align-items:center; justify-content:center; font-weight:700; }
    .small-help { font-size:0.9rem; color:#6b7280; }
  </style>
</head>
<body>
  <div class="container d-flex align-items-center justify-content-center" style="min-height:100vh;">
    <div class="w-100" style="max-width:420px;">
      <div class="card p-4">
        <div class="d-flex align-items-center gap-3 mb-3">
          <div class="logo">ðŸŒ¾</div>
          <div>
            <h4 class="mb-0">Farmer Portal</h4>
            <div class="small-help">Login to access markets, alerts & messages</div>
          </div>
        </div>

        <!-- Login form -->
        <form id="loginForm" method="POST" action="/login">
          <div class="mb-3">
            <label for="phone" class="form-label">Mobile Number</label>
            <input type="tel" pattern="[0-9]{10}" class="form-control" id="phone" name="phone" placeholder="e.g. 98xxxxxxxx" required />
            <div class="form-text">Enter 10-digit mobile number used for OTP</div>
          </div>

          <div class="mb-3">
            <label for="village" class="form-label">Village / Locality</label>
            <input type="text" class="form-control" id="village" name="village" placeholder="Your village or town" required />
          </div>

          <div class="mb-3">
            <label for="password" class="form-label">Password</label>
            <input type="password" class="form-control" id="password" name="password" placeholder="Password" required minlength="6" />
          </div>

          <input type="hidden" id="latitude" name="latitude" />
          <input type="hidden" id="longitude" name="longitude" />

          <div class="d-flex justify-content-between align-items-center mb-3">
            <div class="form-check">
              <input class="form-check-input" type="checkbox" value="1" id="remember" name="remember" />
              <label class="form-check-label" for="remember">Remember me</label>
            </div>
            <button type="button" class="btn btn-outline-secondary btn-sm" id="detectLocBtn">Detect my location</button>
          </div>

          <div class="d-grid mb-2">
            <button type="submit" class="btn btn-primary">Login</button>
          </div>

          <div class="text-center small-help">Don't have an account? <a href="/register">Register here</a></div>
        </form>

        <hr />
        <div class="small-help text-center">
          By logging in you agree to the portal terms. Location is optional â€” used to match nearby support & markets.
        </div>
      </div>

      <!-- Status Toast -->
      <div class="position-fixed bottom-0 end-0 p-3" style="z-index:11">
        <div id="statusToast" class="toast align-items-center text-bg-light border" role="alert" aria-live="assertive" aria-atomic="true">
          <div class="d-flex">
            <div class="toast-body" id="statusMsg"></div>
            <button type="button" class="btn-close me-2 m-auto" data-bs-dismiss="toast" aria-label="Close"></button>
          </div>
        </div>
      </div>

    </div>
  </div>

  <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/js/bootstrap.bundle.min.js"></script>
  <script>
    // Helper to show toast messages
    function showStatus(msg) {
      const statusMsg = document.getElementById('statusMsg');
      statusMsg.textContent = msg;
      const toastEl = document.getElementById('statusToast');
      const toast = new bootstrap.Toast(toastEl);
      toast.show();
    }

    // Geolocation: fill hidden inputs with lat/lon
    document.getElementById('detectLocBtn').addEventListener('click', function () {
      if (!navigator.geolocation) {
        showStatus('Geolocation is not supported by your browser.');
        return;
      }
      showStatus('Detecting location â€” please allow location access in your browser...');
      navigator.geolocation.getCurrentPosition(function (pos) {
        const lat = pos.coords.latitude.toFixed(6);
        const lon = pos.coords.longitude.toFixed(6);
        document.getElementById('latitude').value = lat;
        document.getElementById('longitude').value = lon;
        showStatus('Location detected: ' + lat + ', ' + lon);
      }, function (err) {
        showStatus('Unable to detect location: ' + (err.message || 'permission denied'));
      }, { timeout: 10000 });
    });

    // Simple client-side validation and friendly UX
    document.getElementById('loginForm').addEventListener('submit', function (e) {
      const phone = document.getElementById('phone');
      const pass = document.getElementById('password');
      if (!phone.checkValidity()) {
        e.preventDefault();
        showStatus('Please enter a valid 10-digit mobile number.');
        phone.focus();
        return;
      }
      if (!pass.checkValidity()) {
        e.preventDefault();
        showStatus('Password must be at least ' + pass.minLength + ' characters.');
        pass.focus();
        return;
      }
      // If you want to submit via AJAX, prevent default and send fetch here.
      // For now, allow normal form submit to server endpoint /login
      showStatus('Submitting...');
    });
  </script>
</body>
</html>
